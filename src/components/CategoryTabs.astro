---
import { getCollection } from "astro:content";

export interface Props {
  activeCategory?: string;
}

const { activeCategory = "All" } = Astro.props;

const posts = await getCollection("blog", ({ data }) => !data.draft);
const usedCategories = new Set(posts.map(post => post.data.category).filter(Boolean));

const allDefinedCategories = ["All", "Research", "Tutorial", "Deep Dive"];

const displayCategories = allDefinedCategories.filter(
  category => category === "All" || usedCategories.has(category)
);
---

{
  displayCategories.length > 2 && (
    <div class="category-tabs-wrapper">
      <div class="category-tabs">
        {
          displayCategories.map(category => (
            <a
              href={category === "All" ? "/" : `/category/${category.toLowerCase().replace(" ", "-")}/`}
              class={`category-tab ${activeCategory === category ? "active" : ""}`}
            >
              {category}
            </a>
          ))
        }
      </div>
    </div>
  )
}

<style>
  .category-tabs-wrapper {
    @apply mt-8 mb-2;
  }

  .category-tabs {
    @apply flex gap-2 pb-0 border-b border-skin-line overflow-x-auto;
    /* Hide scrollbar for Chrome, Safari and Opera */
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .category-tabs::-webkit-scrollbar {
    display: none;
  }

  .category-tab {
    @apply relative cursor-pointer border-none bg-transparent px-5 py-3 text-sm font-semibold uppercase tracking-[0.05em] text-skin-muted transition-colors hover:text-skin-base whitespace-nowrap;
  }

  .category-tab.active {
    @apply text-skin-accent;
  }

  .category-tab.active::after {
    content: '';
    @apply absolute bottom-[-1px] left-0 right-0 h-[2px] bg-skin-accent;
  }
</style>
